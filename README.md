# linux-start

Подключение к удалённому серверу Ubuntu с Windows через SSH с использованием сертификата включает два этапа: создание открытого ключа на стороне клиента (Windows) и настройка аутентификации на стороне сервера (Ubuntu). Вот пошаговая инструкция, как это сделать.

▌ Этап 1: Создание сертификата на клиентской машине (Windows)

Мы будем использовать встроенный инструмент OpenSSH для Windows, который доступен начиная с Windows 10 и новее.

▌ Шаги на Windows:

1. Откройте командную строку PowerShell или обычный терминал cmd.exe с правами администратора.

2. Создайте открытый и закрытый ключи командой:

   Для Linux
   ssh-keygen -t rsa -b 4096 -f ~/.ssh/id_rsa

   Для Windows
   ssh-keygen -t rsa -b 4096 -f %userprofile%/.ssh/id_rsa

   Здесь:

   - -t rsa: Тип шифрования RSA.
   - -b 4096: Длина ключа (рекомендуется 4096 бит).
   - -f ~/.ssh/id_rsa: Имя файла закрытого ключа (открытый ключ автоматически создается с расширением .pub).

3. Подтверждение местоположения ключей: программа предложит путь для сохранения ключей. По умолчанию предлагается папка %USERPROFILE%\\.ssh\\. Можно принять предложенное расположение или выбрать другое.

4. Пароль для защиты приватного ключа: введите пароль дважды для дополнительной защиты ваших закрытых ключей (можно оставить пустым, если хотите избежать ввода пароля каждый раз при соединении).

   После завершения команды будут созданы два файла:

   - Закрытый ключ (id_rsa) — храните этот файл конфиденциально!
   - Открытый ключ (id_rsa.pub) — мы отправим его на сервер Ubuntu.

▌ Этап 2: Настройка сервера Ubuntu для подключения по сертификату

▌ Шаги на сервере Ubuntu:

1. Скопируйте созданный открытый ключ (id_rsa.pub) на ваш сервер Ubuntu.

   Для Linux удобно воспользоваться утилитой scp или скопировать содержимое вручную:

   scp ~/.ssh/id_rsa.pub user@your_server_ip:/tmp/

   Для Windows WinCSP или pscp из комплекта PuTTY (доступно даже без установки, если использовать portable)
   "C:\Program Files\PuTTY\pscp.exe" %userprofile%/.ssh/id_rsa.pub user@192.168.1.xx:/home/user

   Или вручную откройте файл на вашем компьютере и вставьте его содержание в новый файл на сервере:

   nano /tmp/id_rsa.pub
   
2. На сервере добавьте открытый ключ в файл разрешенных пользователей (authorized_keys):
   
   mkdir -p ~/.ssh && chmod 700 ~/.ssh
   cat /tmp/id_rsa.pub >> ~/.ssh/authorized_keys
   rm /tmp/id_rsa.pub # Удаляем временный файл
   chmod 600 ~/.ssh/authorized_keys

   Как вариант без создания временного файла:
   echo ssh-rsa текст_публичного_ключа >> ~/.ssh/authorized_keys
   
3. Убедитесь, что настройки SSH разрешают использование открытых ключей:

    Проверьте конфигурационный файл /etc/ssh/sshd_config:
   
   sudo nano /etc/ssh/sshd_config
   
   Убедитесь, что установлены следующие значения:
   
   PubkeyAuthentication yes
   PasswordAuthentication no  # Отключаем подключение по паролю (если желаете)
   
4. Перезапустите службу SSH:

   sudo systemctl restart sshd
   
▌ Этап 3: Тестируем соединение

Вернувшись на компьютер с Windows, попробуйте подключиться к вашему серверу Ubuntu с использованием ключа:

ssh -i ~/.ssh/id_rsa user@your_server_ip

Если всё настроено правильно, вас сразу пропустят на сервер без ввода пароля.

---
Теперь вы успешно создали сертификат и используете его для безопасного подключения к серверу Ubuntu по SSH с компьютера под управлением Windows.

Дополнительно можно создать файл config для алиасов. Пример содержимого такого файла:

Host gitlab
    HostName 192.168.1.2
    User devops
    IdentityFile ~/.ssh/gitlab_rsa

Host psql
    HostName 192.168.1.3
    User devops
    IdentityFile ~/.ssh/psql_rsa
